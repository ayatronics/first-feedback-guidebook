# どう報告すればいいのか分からない

フィードバックしたいOSSとフィードバックしたい内容、そして、フィードバックする先が決まりました。次は、実際にイシュートラッカーやメーリングリストに「報告」というフィードバックを行う際の、*より良い報告の書き方*を説明しましょう。

といっても、ここで説明する内容は、すでに業務でたくさんバグ票を書いているような人にとっては目新しい話ではないです。逆に、まだ業務でバグレポートを書くということを経験したことがない人や、いいレポートを書けずに困っているという人には、この章は業務の上でも役に立つかもしれません。

ポイントは、*開発者の負担が減るような報告にする*ということです。もしあなたがすでにソフトウェア開発の仕事をしているなら、あるいは、自分で作ったソフトウェアを長期間メンテナンスし続けているなら、不具合の修正に日々苦労しているのではないでしょうか。そんなときに*「こういう情報があると助かるのになあ」と思うような情報*こそ、報告に書くべき情報と言えます。


## 報告に欠かせない3つの基本要素

開発者コミュニティの目的は、ソフトウェアの改善・改良、ソフトウェアの問題を解決することです。よって、報告する内容もそれに沿ったものとなりあｍす。では、一体どんな情報があれば問題解決の役に立つのでしょうか？

一般的に「報告に必ず盛り込むべき要素」とされるのは以下の3点です。

* 再現手順（Steps to reproduce）
* 実際に得られる結果（Actual result）
* 期待される結果（Expected result）

このどれが欠けても、問題の解決は途端に難しくなります。マクロなシステムからミクロな関数まであらゆる規模の「問題」を表現するための基本原則と言えるでしょう。

（イラスト：1本でも2本でも立たないが3本の脚が揃うと容易に自立する、三脚に例えた絵）

プロジェクトによっては報告の書き方・形式を定めている場合がありますが、十中八九どのプロジェクトでも、言い方は多少異なっていても[^variations-of-report-information]この3要素は必ず含めるように指定されています。

[^variations-of-report-information]: 例えば「実際に得られる結果」→「起こったこと」「現象」、「再現手順」→「やったこと」、「期待される結果」→「起こって欲しいこと」のような言い方になっている場合があります。

報告には他にも、以下のような情報を添える場合もあります。

* 不具合の報告か、新機能の要望か
* セキュリティ上の脆弱性かどうか
* 影響度はどのくらいの大きさか、どの程度深刻か
* どのモジュールに関する報告か

ただ、これらはあくまで*基本の3要素を踏まえた上での補足情報*です。プロジェクトの運営方針によっては、最低限基本の3要素が揃っていない報告は一律に却下される場合もあります。慣れないうちは特に、「自分がいかに困っているか」「その問題の影響度はどのくらいか」ということばかり一生懸命書いてしまいたくなるところですが、その気持ちはグッとこらえて、まずは基本の3要素をきっちり押さえるようにしましょう。


## 再現条件をまとめよう

報告の中で、労力的に最も大きなウェイトを占めるのが*再現手順の特定*です。実際に、開発の現場でも不具合の修正に要する時間のほとんどはそこに費やされていると言っても過言ではないでしょう。*不具合が修正されるかどうかは、ほぼ、「現象を確実に再現できる手順・条件」が明らかになっているかどうかで決まります*。

フィードバックするネタの見つけ方の話の中で、「OSS Gateワークショップではフィードバック初心者の方向けのファーストステップとして、公式の導入手順の中で遭遇したつまずきのフィードバックをおすすめしている」ということを述べました。このやり方をおすすめしているのには、*再現手順が明確だから*という理由もあります。「実際に行ってつまずいたときの操作手順」＝「公式の導入手順」で、改めて自分で手順を書き起こずとも、公式の資料を下敷きにできるからです。

他方、使い始めた直後ではなくある程度使い込んだ状態で不意に遭遇したつまずきは、再現手順を特定するのに苦労しがちです。

例として、筆者が[実際に行った、Firefoxのウィンドウの不具合の報告](https://bugzilla.mozilla.org/show_bug.cgi?id=1521692)の場合を考えてみます。出発点は、以下のようなメモでした。

* Webページから開かれたポップアップウィンドウが閉じられなくなった。
* OSはWindows Server 2008。
* FirefoxのバージョンはESR60.1。

たったこれだけの、シンプルなメモです。これに対して、最終的に報告した内容は以下のようなものでした。

```
再現手順：

1. Windows 7が動作する環境を用意する。Windowsのデスクトップテーマは「クラシック」を選択する。
2. Firefox 64.0.2またはFirefox ESR60.4.0をインストールする。
3. Firefoxを起動する。
4. ツールバーの上で右クリックして、メニューの中の「メニューバー」にチェックを入れ、メニューバーを常に表示する状態にする。
5. キーボードショートカット「Ctrl-Shift-K」を入力して、Webコンソールを開く。
6. コンソールに「window.open('about:blank','_blank','toolbar')」と入力して、Enterキーを押す。
7. ポップアップウィンドウがFirefoxのポップアップブロッカーによってブロックされるので、「このサイト（～）によるポップアップを許可する」をクリックする。
8. 開かれたポップアップウィンドウのウィンドウコントロール[^window-control]部にあるクローズボックスをクリックする。

期待される結果：

* ポップアップウィンドウが閉じられる。また、最小化・最大化のボタンも機能する。

実際の結果：

* ポップアップウィンドウが閉じられない。また、最小化・最大化のボタンも機能しない。
```

[^window-control]: Windowsではウィンドウの右上にある「最小化」「最大化」「閉じる」の3つのボタンのこと。

そのソフトウェアの複数のバージョン・複数の実行環境で同じ現象が起こる場合、*前提条件にあたる部分は再現手順とは別立てで記載する*のもよいでしょう[^environment-in-str]。

[^environment-in-str]: 実際に、筆者が行った報告では2は「再現手順」の中には含めず、見出しを分けて後段で「現象が再現するFirefoxのバージョン」として別途記載しました。この例では説明のためにあえて、環境に関する情報も「再現手順」の中に収める書き方にしています。

最初のたった数行のメモから、どうやってこの報告を作ったのか。過程を詳しく見ていくことにします。


### まず「まっさらな環境」での再現を試みる

ソフトウェアを使い込んだ状態で不具合に遭遇した場合でも、筆者は基本的には、*現象が発生した環境やソフトウェアについて、いわゆる「まっさらな、クリーンな環境」を用意して、その時点で判明している手順だけから同じ現象が再現するかどうかを最初に調べます*。これで現象が再現すれば、そこまででやった操作を手順として報告するだけで済むからです。

まっさらな環境とは、以下のような状態を指します。

* OSは、インストールした直後の状態。
* 対象のソフトウェアは、公式の導入手順に従って導入した直後の状態。
* OSも対象のソフトウェアも、設定は可能な限り変更していない。
* 対象のソフトウェアは、まだ一度も起動されていない。（ユーザー設定は、2度目以降の検証をする前に初期化する。）

まっさらな環境は、Microsoft AzureやAmazon EC2のようなクラウドサービスでインスタンスを新規に作成したり、なるべく追加の出費を避けたい場合は[VirtualBox](https://www.virtualbox.org/)や[VMware Workstation Player](https://www.vmware.com/jp/products/workstation-player.html)などを使って自分で仮想マシンを構築したりして用意します。問題の原因がハードウェアやそれに近い部分にあるような場合は、仮想環境ではなく物理的なハードウェアから用意しないといけない場合もあります。ここにあまり手間をかけられない場合は、*そのソフトウェアのユーザー設定を削除するだけ*や、現在の環境で*新規にユーザーを作って、そちらでログインし直すだけ*で済ませる場合もあります。

逆に言うと、以下のような「まっさらでない状態」「現象発生時と異なるソフトウェアやバージョン」を使うのは失敗の元です。

* 現象が発生したのと違うプラットフォームを使う。
  - Linuxのサーバー上で発生した現象について、手元のmacOSを使う。
  - CentOSで発生した現象について、手元にあったDebianを使う。
  - iPhoneで発生した現象について、Androidの端末を使う。
* 現象が発生したのと違うバージョンを使う。
  - Windows 7で発生した現象について、Windows 10上を使う。
  - Ruby 2.7で発生した現象について、Ruby 2.4を使う。
* 現象が発生した状況と違う使い込まれ方をしたユーザー環境を使う。
  - 使い始めたばかりのFirefoxの上で発生した現象について、自分の普段使いの環境のFirefoxを使う。
  - 会社で使い込んだVimの上で発生した現象について、自宅のPC上のVimを使う。

ある程度の経験を積んだ人であれば、それまでの経験に基づいて「OSは別でもそのソフトウェアのバージョンだけ一致していれば十分」のような判断ができる場合もあります。実際に、前述の例のケースでは筆者は以下の環境を使いました。

* VirtualBox上の仮想マシン上のWindows 7（Windows Server 2008ではない）
* Firefox ESR60.1

これは、以下のような理由に基づきます。

* Windows Serverは、デスクトップ環境に関しては対応するバージョンのクライアント用Windowsとほぼ同等である。
* Firefoxは実行環境のバージョンを識別する仕組みを持っているが、その仕組みの上では、Windows 7とWindows Server 2008は等価として扱われることがすでに分かっている。
* Windows版のFirefoxのブラウザウィンドウにおけるウィンドウコントロールはFirefox自体が独自に提供しており、Windowsの標準的なアプリケーションの物は使われていない、ということがすでに分かっている。

ただ、このような判断は非常に難しいものですし、経験者でもアテが外れることはよくあります。*違う環境でも似た問題が再現するが、調べてみたら表面的には似ていても問題の内容は全く別だった*、という「他人の空似」に遭遇してしまうことすらあり、そうなってしまうと、報告をする上では余計な回り道にしかなりません。皆さんはなるべく横着をせず、*実行環境やソフトウェアのバージョンを揃えた「まっさらな状態」から再現手順の特定を始めることを原則としてください*。


### コラム：普段使いの環境の中で手軽に「まっさらな状態」を作る

現代の多くのソフトウェアは、ユーザー設定はソフトウェアのインストール先とは別の位置に保存されています。以下はその保存先としてよく使われるフォルダー（ディレクトリー）の位置です。

* `C:\Users\（アカウント名）\AppData\Roaming\（ソフトウェア名またはベンダー名）\`（Windows Vista以降のWindows）
* `/Users/（アカウント名）/Library/Application Support/（ソフトウェア名またはベンダー名）/`（macOS）
* `/home/（アカウント名）/.（ソフトウェア名またはベンダー名）/`（Linux、BSDなどのUnix系）

これらの場所にフォルダーがあれば、それを一時的にリネームする（例えば、`Mozilla`というフォルダーの名前を`Mozilla_`に変更するなど）と、普段のユーザー設定を残したままで「まっさらな状態」でソフトウェアを起動できます。また、調査が終わったら、リネームしたフォルダー名を元に戻すだけで普段使いの環境に戻せます。

ただ、この方法には「普段使いの状態とまっさらな環境とを同時に動かして試せない」というデメリットがあります。また、WindowsのアプリケーションやUnix系環境でのGNOMEの設定などでは、上記の場所ではない特別な場所に情報を保存する例もあります。スマートフォンやタブレットでは、ユーザー設定の保存先に簡単にはアクセスできない場合もあります。そのような場合も含めると、より安全なのは、OSに新しいユーザーを作成して、全データをユーザー単位で切り替えるやり方でしょう。


### さらに再現条件を絞り込む

さて、まっさらな環境で現象を再現できればいいのですが、大抵はうまくいかないことの方が多いでしょう。ここからは*再現条件の絞り込み*に入っていきます。

「再現条件を絞り込む」とは、*さまざまな条件・設定があり得る中から「この条件さえ整えれば現象が再現する」という最小の条件を特定すること*です。これには、まっさらな環境に対して現象が再現するまで少しずつ条件を足していく*足し算*の方向と、実際に現象が再現する状況から少しずつ条件を減らしてまっさらな環境に近付けていく*引き算*の方向の2通りが考えられます。多くの場合、足し算の方向だけで現象を再現させることは難しく、まっさらな環境を参照しながら引き算で条件を特定していくことになります。








### どの程度細かく書けばいい？

「再現手順」を書くにあたって気をつけたいのは、*開発者が戸惑わないように、情報を多めに盛り込む*ということです。

前提条件や再現手順をどの程度の粒度で書くかはセンスが問われる部分ですが、基本的には、*自分で「細かすぎる」と思うくらいに細かく書くように意識する*のがよいです。というのも、*報告に不慣れな人ほど、荒く・情報が不足した報告を書いてしまいがち*だからです。実際に、

* ポップアップウィンドウを開いたら、ウィンドウコントロールが表示されなかった。

と、前述の最初のメモのような1行だけの「再現手順」が添えられた報告は数多くあります。

なぜこうなってしまうのか。それは、報告者にとっての「自分がやったことのうち、自分が意識している範囲のこと」だけを言葉にしたためです。

ちょっと待ってください、「報告者にとっての」？　はい、「誰にとっての」という所が実は重要なんです。ここまでは単に「再現手順」とだけ書いていましたが、実際には、報告に書く必要があるのは*開発者が現象を手元で再現するための手順*なのです。*再現手順の説明の主語は「報告者であるあなた」ではなく「その報告を読んで試す開発者」にする必要がある*、このことを意識するのが「よい再現手順」を書くためのコツです。

（イラスト：報告者の脳内にあるさまざまな前提＋端的な報告では意味が通っても、開発者の元に届いた端的な報告では意味が通らなくなってしまう、という様子）

「報告者の自分にとっては当たり前でも、それを読む開発者にとっては当たり前ではない」という情報は非常に多いです。例えば先の例でも、報告者と開発者の間では以下のようなすれ違いが起こるかもしれません。

* あなたはWindowsを使っているかもしれませんが、開発者はmacOSを使っているかもしれません。
* 「Webコンソールを開く」とき、あなたはキーボードで操作するかもしれませんが、開発者はメニューから項目を選んで行うかもしれません。
* メニューを選択するとき、あなたはいつものようにキーボードで操作するかもしれませんが、開発者はマウスで操作するかもしれません。
* 「ポップアップウィンドウを開く」という操作は、あなたにとっては勤務先の社内システムでいつもの操作をするだけかもしれませんが、開発者はSNSのWebサイトで操作するかもしれません。
* あなたは10年以上使い込んだ設定を伴ってFirefoxを使っているかもしれませんが、開発者はまっさらな新規の設定でFirefoxを起動するかもしれません。
* あなたはポップアップブロック機能を無効にしているかもしれませんが、開発者はポップアップブロック機能を使っているかもしれません。
* あなたはそれを「ウィンドウコントロール」と呼んでいるかもしれませんが、開発者は「ウィンドウボタン」と呼んでいるかもしれません。
* あなたが「最新版」と思っている物は、開発者にとっての「最新版」ではないかもしれません。あなたは「一般に公開されている最新版」を使っていて、開発者は「まだリリースされていない開発中の最新版」を使っているかもしれません。

同じことが、「実際に得られる結果」や「期待される結果」の説明でも言えます。

* あなたが「当然こうなるはずだ」と思う内容と、開発者が「当然こうなるだろう」と思っている内容は、違うかもしれません。
* あなたが「これはおかしい」と思う内容は、開発者にとっては「当然そうあるべきだ」と思える内容かもしれません。
* あなたが専門知識に基づいて「当然こうでなければならない」と思う内容は、開発者にとっては「なんでそうなの？」と思う内容かもしれません。開発者はあなたよりその分野に詳しくないかもしれません。

（イラスト：報告者と開発者の間で想像している物がことごとく異なっている様子）

あなたは、初めての報告をすっきりスマートに済ませたいと思うかもしれません。端的に簡潔に書いた方が良いに違いない、あまりクドクド書いても迷惑になるだろう、と気を回したくなる気持ちはよく分かります。筆者もかつてはそう考えていた時期がありました。

ですが、あなたと開発者が別の人間である以上、あらゆる所で認識の齟齬は発生し得ます。下手に省略して伝わらない報告になってしまうよりも、不格好でも必要な情報が漏れなく書かれている報告のほうが、開発者にとってはずっと有用でありがたいものなのです。

報告するときは、自分にとっての*「当然」を疑って*、普段サラッと流していることでも*解像度を上げて*見直して、「こんなこと説明しなくても伝わるだろう」と思っているようなことほど*意識的に言葉にするよう心がけましょう*。




### 画像や動画も使っていい



あるいは、ここまでやるならむしろ*フローチャートの図*で情報を示してもいいかもしれません。そう、説明する方法は「英語の文章」でなくてもいいのです。スクリーンショットで示した方が早ければ*スクリーンショットに丸や矢印を描き込んだ物を添付してもいい*ですし、静止画では説明が難しければ[スクリーンキャストをYouTubeあたりにアップロードして伝えてもいい](20180731)です。あるいは、


### 実際に動かせる物があると、なおよい



プログラムやデータを実際に作れるのであれば、*それを使って実行すれば必ず現象が再現するというテストケース*を添付するのが一番いいです。

Dockerコンテナ




## 「Regression Window」を特定しよう




